'use strict';

var http = require('http');

module.exports = function (options) {
  return function (req, res, next) {
    return function (err) {
      if (err.message === http.STATUS_CODES[404] || req.params.id && err.path === options.idProperty && err.name === 'CastError') {
        req.erm.statusCode = 404;
      } else {
        req.erm.statusCode = req.erm.statusCode && req.erm.statusCode >= 400 ? req.erm.statusCode : 400;
      }

      options.onError(err, req, res, next);
    };
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lcnJvckhhbmRsZXIuanMiXSwibmFtZXMiOlsiaHR0cCIsInJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwib3B0aW9ucyIsInJlcSIsInJlcyIsIm5leHQiLCJlcnIiLCJtZXNzYWdlIiwiU1RBVFVTX0NPREVTIiwicGFyYW1zIiwiaWQiLCJwYXRoIiwiaWRQcm9wZXJ0eSIsIm5hbWUiLCJlcm0iLCJzdGF0dXNDb2RlIiwib25FcnJvciJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxPQUFPQyxRQUFRLE1BQVIsQ0FBYjs7QUFFQUMsT0FBT0MsT0FBUCxHQUFpQixVQUFVQyxPQUFWLEVBQW1CO0FBQ2xDLFNBQU8sVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CQyxJQUFwQixFQUEwQjtBQUMvQixXQUFPLFVBQVVDLEdBQVYsRUFBZTtBQUNwQixVQUFJQSxJQUFJQyxPQUFKLEtBQWdCVCxLQUFLVSxZQUFMLENBQWtCLEdBQWxCLENBQWhCLElBQTJDTCxJQUFJTSxNQUFKLENBQVdDLEVBQVgsSUFBaUJKLElBQUlLLElBQUosS0FBYVQsUUFBUVUsVUFBdEMsSUFBb0ROLElBQUlPLElBQUosS0FBYSxXQUFoSCxFQUE4SDtBQUM1SFYsWUFBSVcsR0FBSixDQUFRQyxVQUFSLEdBQXFCLEdBQXJCO0FBQ0QsT0FGRCxNQUVPO0FBQ0xaLFlBQUlXLEdBQUosQ0FBUUMsVUFBUixHQUFxQlosSUFBSVcsR0FBSixDQUFRQyxVQUFSLElBQXNCWixJQUFJVyxHQUFKLENBQVFDLFVBQVIsSUFBc0IsR0FBNUMsR0FBa0RaLElBQUlXLEdBQUosQ0FBUUMsVUFBMUQsR0FBdUUsR0FBNUY7QUFDRDs7QUFFRGIsY0FBUWMsT0FBUixDQUFnQlYsR0FBaEIsRUFBcUJILEdBQXJCLEVBQTBCQyxHQUExQixFQUErQkMsSUFBL0I7QUFDRCxLQVJEO0FBU0QsR0FWRDtBQVdELENBWkQiLCJmaWxlIjoiZXJyb3JIYW5kbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gIHJldHVybiBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgIGlmIChlcnIubWVzc2FnZSA9PT0gaHR0cC5TVEFUVVNfQ09ERVNbNDA0XSB8fCAocmVxLnBhcmFtcy5pZCAmJiBlcnIucGF0aCA9PT0gb3B0aW9ucy5pZFByb3BlcnR5ICYmIGVyci5uYW1lID09PSAnQ2FzdEVycm9yJykpIHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSA0MDRcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSByZXEuZXJtLnN0YXR1c0NvZGUgJiYgcmVxLmVybS5zdGF0dXNDb2RlID49IDQwMCA/IHJlcS5lcm0uc3RhdHVzQ29kZSA6IDQwMFxyXG4gICAgICB9XHJcblxyXG4gICAgICBvcHRpb25zLm9uRXJyb3IoZXJyLCByZXEsIHJlcywgbmV4dClcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
//# sourceMappingURL=errorHandler.js.map
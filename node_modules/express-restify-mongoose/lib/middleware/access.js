'use strict';

module.exports = function (options) {
  var errorHandler = require('../errorHandler')(options);

  return function (req, res, next) {
    var handler = function handler(err, access) {
      if (err) {
        return errorHandler(req, res, next)(err);
      }

      if (['public', 'private', 'protected'].indexOf(access) < 0) {
        throw new Error('Unsupported access, must be "private", "protected" or "public"');
      }

      req.access = access;
      next();
    };

    if (options.access.length > 1) {
      options.access(req, handler);
    } else {
      handler(null, options.access(req));
    }
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2FjY2Vzcy5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwib3B0aW9ucyIsImVycm9ySGFuZGxlciIsInJlcXVpcmUiLCJyZXEiLCJyZXMiLCJuZXh0IiwiaGFuZGxlciIsImVyciIsImFjY2VzcyIsImluZGV4T2YiLCJFcnJvciIsImxlbmd0aCJdLCJtYXBwaW5ncyI6Ijs7QUFBQUEsT0FBT0MsT0FBUCxHQUFpQixVQUFVQyxPQUFWLEVBQW1CO0FBQ2xDLE1BQU1DLGVBQWVDLFFBQVEsaUJBQVIsRUFBMkJGLE9BQTNCLENBQXJCOztBQUVBLFNBQU8sVUFBVUcsR0FBVixFQUFlQyxHQUFmLEVBQW9CQyxJQUFwQixFQUEwQjtBQUMvQixRQUFNQyxVQUFVLFNBQVZBLE9BQVUsQ0FBVUMsR0FBVixFQUFlQyxNQUFmLEVBQXVCO0FBQ3JDLFVBQUlELEdBQUosRUFBUztBQUNQLGVBQU9OLGFBQWFFLEdBQWIsRUFBa0JDLEdBQWxCLEVBQXVCQyxJQUF2QixFQUE2QkUsR0FBN0IsQ0FBUDtBQUNEOztBQUVELFVBQUksQ0FBQyxRQUFELEVBQVcsU0FBWCxFQUFzQixXQUF0QixFQUFtQ0UsT0FBbkMsQ0FBMkNELE1BQTNDLElBQXFELENBQXpELEVBQTREO0FBQzFELGNBQU0sSUFBSUUsS0FBSixDQUFVLGdFQUFWLENBQU47QUFDRDs7QUFFRFAsVUFBSUssTUFBSixHQUFhQSxNQUFiO0FBQ0FIO0FBQ0QsS0FYRDs7QUFhQSxRQUFJTCxRQUFRUSxNQUFSLENBQWVHLE1BQWYsR0FBd0IsQ0FBNUIsRUFBK0I7QUFDN0JYLGNBQVFRLE1BQVIsQ0FBZUwsR0FBZixFQUFvQkcsT0FBcEI7QUFDRCxLQUZELE1BRU87QUFDTEEsY0FBUSxJQUFSLEVBQWNOLFFBQVFRLE1BQVIsQ0FBZUwsR0FBZixDQUFkO0FBQ0Q7QUFDRixHQW5CRDtBQW9CRCxDQXZCRCIsImZpbGUiOiJhY2Nlc3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgY29uc3QgZXJyb3JIYW5kbGVyID0gcmVxdWlyZSgnLi4vZXJyb3JIYW5kbGVyJykob3B0aW9ucylcclxuXHJcbiAgcmV0dXJuIGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgY29uc3QgaGFuZGxlciA9IGZ1bmN0aW9uIChlcnIsIGFjY2Vzcykge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgcmV0dXJuIGVycm9ySGFuZGxlcihyZXEsIHJlcywgbmV4dCkoZXJyKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoWydwdWJsaWMnLCAncHJpdmF0ZScsICdwcm90ZWN0ZWQnXS5pbmRleE9mKGFjY2VzcykgPCAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBhY2Nlc3MsIG11c3QgYmUgXCJwcml2YXRlXCIsIFwicHJvdGVjdGVkXCIgb3IgXCJwdWJsaWNcIicpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlcS5hY2Nlc3MgPSBhY2Nlc3NcclxuICAgICAgbmV4dCgpXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG9wdGlvbnMuYWNjZXNzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgb3B0aW9ucy5hY2Nlc3MocmVxLCBoYW5kbGVyKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaGFuZGxlcihudWxsLCBvcHRpb25zLmFjY2VzcyhyZXEpKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
//# sourceMappingURL=access.js.map